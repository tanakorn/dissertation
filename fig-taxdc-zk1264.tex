
\begin{figure}
\fbox{
\begin{minipage}{\textwidth}
\vspace{10pt}
\begin{quote}
{\bf \zk{1264}:}
\enumerate{
\item \fev{Follower F crashed} in the past,
\item \fev{F reboots} and joins the cluster; then \fev{F synchronizes data} with Leader L
\item F sends FOLLOWERINFO message to L [synchronization message]
\item L sends LEADERINFO message to F [synchronization message]
\item F sends ACKEPOCH message to L [synchronization message]
\item L sends SNAP message to F [synchronization message]
\item L sends data tree snapshot to F [synchronization message]
\item L sends NEWLEADER message to F [synchronization message]
\item \fev{Client C sends a request} to update data with Tx-\#15 to L; L does atomic broadcast to update all followers
\item L sends update proposal message for Tx-\#15 to F [broadcast message]
\item F sends update ack message for Tx-\#15 to L [broadcast message]
\item \fev{L sends update commit message} for Tx-\#15 to F [broadcast message]
\item \fev{F applies the update} for Tx-\#15 to in-memory data tree, but not to on-disk log (because F has not received UPTODATE message)
\item \fev{L sends UPTODATE message} to F [synchronization message]
\item C sends a request to update data with Tx-\#16 to L
\item L sends update proposal for Tx-\#16 to F
\item F sends update ack for Tx-\#16 to L
\item L sends update commit for Tx-\#16 to F
\item F applies the update for Tx-\#16 to in-memory data tree and on-disk log
\item \fev{F crashes} (before \fev{F does snapshot})
\item F reboots and joins the cluster again
\item L synchronized data with F by sending update starting from Tx-\#17
\item F loses the update for Tx-15 C did in step 9
}
\end{quote}
\vspace{10pt}
\end{minipage}
}
\mycaption{fig-taxdc-zk1264}{A DC bug in ZooKeeper}{This figure shows Figure
\ref{fig-zk1264} again. It shows a DC bug in ZooKeeper that is caused from a mix
of untimely message arrivals and crash timing. This bug surfaces when a follower
receives update commit messasge (step 12) in the middle of an atomic operation
(step 3-14) and the follower crashes before it does snapshot (step 20)}
\end{figure}



%\ev{(5)} L forwards the update request txid \#15 to F,

% ---------------------------------------------------- CA simple
% ---------------------------------------------------- CA complex
% ---------------------------------------------------- HBase simple
% ---------------------------------------------------- HBase complex
% ---------------------------------------------------- MR simple
% ---------------------------------------------------- MR complex
% ---------------------------------------------------- ZK simple
% ---------------------------------------------------- ZK complex
