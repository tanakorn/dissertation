


\begin{figure}

% MR-5505: CM
\begin{center}
\fbox{
\begin{minipage}{5.5in}
{\bf \mr{5505}:}
\begin{enumerate}
\item A job finishes,
\item Application manager (AM) sends a ``remove-app'' message to Resource Manager (RM),
\item RM receives the message,
\item AM is unregistering,
\item \fev{RM crashes} before completely processes the message,
\item AM finishes unregistering,
\item \fev{RM reboots} and reads the old state file,
\item RM thinks the job has never started and runs the job again.
\end{enumerate}
%\ev{(1)} A job finishes,
%\ev{(2)} Application manager (AM) sends a ``remove-app'' message
%to Resource Manager (RM),
%\ev{(3)} RM receives the message,
%\ev{(4)} AM is unregistering,
%\ev{(5)} \fev{RM crashes} before completely processes the message,
%\ev{(6)} AM finishes unregistering,
%\ev{(7)} \fev{RM reboots} and reads the old state file,
%\ev{(8)} RM thinks the job has never started and runs the job again.
\end{minipage}
}
\end{center}


% CASS-3395: Hinted handoff
\vten
\begin{center}
\fbox{
\begin{minipage}{5.5in}
{\bf \cs{3395}}
\begin{enumerate}
\item Three nodes N1-3 started and formed a ring,
\item Client writes data,
\item \fev{N3 crashes},
\item Client updates the data via N1; N3 misses the update,
\item \fev{N3 reboots},
\item N1 begins the hinted handoff process,
\ev{(7)} Another client reads the data with strong consistency via N1 as
a coordinator,
\item N1 and N2 provide the updated value, but N3 still provides
the stale value,
\item The coordinator gets ``confused'' and returns the stale value to
the client!
\end{enumerate}
%\ev{(1)} Three nodes N1-3 started and formed a ring,
%\ev{(2)} Client writes data,
%\ev{(3)} \fev{N3 crashes},
%\ev{(4)} Client updates the data via N1; N3 misses the update,
%\ev{(5)} \fev{N3 reboots},
%\ev{(6)} N1 begins the hinted handoff process,
%\ev{(7)} Another client reads the data with strong consistency via N1 as
%a coordinator,
%\ev{(8)} N1 and N2 provide the updated value, but N3 still provides
%the stale value,
%\ev{(9)} The coordinator gets ``confused'' and returns the stale value to
%the client!
\end{minipage}
}

\end{center}


% MR 5863 (new)




\mycaption[Complexity of Deep Bugs]{code-oldbugs}{Complexity of Deep Bugs}{
%
Above are two sample deep bugs in Hadoop and Cassandra.  A sample
for ZooKeeper was shown in the introduction
(\sec\ref{sec-intro}).  Deep bugs are complex to reproduce; crash and
reboot events must happen in a specific order within a long sequence of
events (there are more events behind the events we show in the
bug descriptions above).
To see the high degree of complexity of other old bugs
that we reproduced, interested readers can click the
  issue numbers (hyperlinks) in Table~\ref{tab-oldbugs}.
%
}
%\vminfive
\end{figure}



\if 0

% CASS-3626: Gossiper
\vten
\fbox{
\begin{minipage}{2.95in}
{\bf \cassandra{3626}}
\ev{(1)} Three nodes N1, N2, and N3 start, sending join messages,
\ev{(2)} N1 receives message from N3,
\ev{(3)} N2 receives message from N3,
\ev{(4)} \fev{N3 crashes before} it detects its peers,
\ev{(5)} N1 receives message from N2,
\ev{(6)} N2 receives message from N1,
\ev{(7)} \fev{N2 crashes},
\ev{(8)} N1 detects N2 and N3 are down,
\ev{(9)} \fev{N3 reboots},
\ev{(10)} N3 wrongly believes N2 is up.
\end{minipage}
}
\fi

